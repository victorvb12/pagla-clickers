<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Pagla Clickers</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 0; }
    header, footer { background: #343a40; color: white; text-align: center; padding: 10px; }
    .container { padding: 20px; max-width: 1000px; margin: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; }
    th { background-color: #007bff; color: white; }
    button { padding: 5px 10px; margin: 0 5px; cursor: pointer; }
  </style>
</head>
<body>

<header><h1>Admin Dashboard</h1></header>
<div class="container">
  <h2>Users</h2>
  <table id="usersTable">
    <thead><tr><th>Email</th><th>Referrals</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>

  <h2>Tasks</h2>
  <table id="tasksTable">
    <thead><tr><th>Title</th><th>Description</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</div>
<footer><p>Pagla Clickers Admin Â© 2025</p></footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAg-6k48R9c7ZK0xGe0BtNOa-5lF5JfmdI",
    authDomain: "pagla-b1c17.firebaseapp.com",
    projectId: "pagla-b1c17",
    storageBucket: "pagla-b1c17.appspot.com",
    messagingSenderId: "192578902502",
    appId: "1:192578902502:web:1595070cdac289170f5e27"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadUsers() {
    const usersSnapshot = await getDocs(collection(db, "users"));
    const tbody = document.getElementById("usersTable").querySelector("tbody");
    tbody.innerHTML = "";
    usersSnapshot.forEach(docSnap => {
      const data = docSnap.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.email}</td>
        <td>${data.referralCount || 0}</td>
        <td><button onclick="deleteUser('${docSnap.id}')">Delete</button></td>`;
      tbody.appendChild(tr);
    });
  }

  async function loadTasks() {
    const tasksSnapshot = await getDocs(collection(db, "tasks"));
    const tbody = document.getElementById("tasksTable").querySelector("tbody");
    tbody.innerHTML = "";
    tasksSnapshot.forEach(docSnap => {
      const data = docSnap.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.title}</td>
        <td>${data.description}</td>
        <td><button onclick="deleteTask('${docSnap.id}')">Delete</button></td>`;
      tbody.appendChild(tr);
    });
  }

  window.deleteUser = async (id) => {
    if (confirm("Are you sure?")) {
      await deleteDoc(doc(db, "users", id));
      loadUsers();
    }
  };

  window.deleteTask = async (id) => {
    if (confirm("Delete this task?")) {
      await deleteDoc(doc(db, "tasks", id));
      loadTasks();
    }
  };

  loadUsers();
  loadTasks();
</script>

</body>
</html>
