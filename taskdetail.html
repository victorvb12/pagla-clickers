<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jobs List</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
</head>
<body>
  <h1>Jobs List</h1>
  <div id="jobs-container">Loading jobs...</div>

  <script>
    // Your Firebase config here
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      // rest of config...
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Wait for auth state to ensure user is logged in
    auth.onAuthStateChanged(user => {
      if (user) {
        console.log('Logged in as:', user.uid);
        loadJobs();
      } else {
        document.getElementById('jobs-container').innerText = "Please log in to see jobs.";
      }
    });

    function loadJobs() {
      const jobsRef = db.collection('jobs');
      jobsRef.get()
        .then(snapshot => {
          const container = document.getElementById('jobs-container');
          container.innerHTML = ''; // clear loading text

          if (snapshot.empty) {
            container.innerText = "No jobs found.";
            return;
          }

          snapshot.forEach(doc => {
            const job = doc.data();

            // Example: show job title, description, reward, and proofs array
            const jobDiv = document.createElement('div');
            jobDiv.style.border = "1px solid #ccc";
            jobDiv.style.margin = "10px";
            jobDiv.style.padding = "10px";

            // Proofs summary - unique proof types only
            const uniqueProofs = [...new Set(job.proofs)];

            jobDiv.innerHTML = `
              <h3>${job.title}</h3>
              <p><strong>Description:</strong> ${job.description}</p>
              <p><strong>Reward:</strong> ${job.reward} points</p>
              <p><strong>Proof types required:</strong> ${uniqueProofs.join(", ")}</p>
              <button onclick="showSubmissionForm('${doc.id}', ${JSON.stringify(uniqueProofs)})">Submit Work</button>
            `;

            container.appendChild(jobDiv);
          });
        })
        .catch(error => {
          console.error("Error loading jobs:", error);
          document.getElementById('jobs-container').innerText = "Error loading jobs.";
        });
    }

    // Example: submission form depending on proof types
    function showSubmissionForm(jobId, proofTypes) {
      let formHtml = `<h3>Submit Work for Job ${jobId}</h3><form id="submissionForm">`;

      // Show form fields depending on proofTypes array
      if (proofTypes.includes('text')) {
        formHtml += `<label>Text Proof:<br><textarea name="textProof" required></textarea></label><br>`;
      }
      if (proofTypes.includes('screenshot')) {
        formHtml += `<label>Screenshot Proof:<br><input type="file" name="screenshotProof" accept="image/*" required></label><br>`;
      }

      formHtml += `<button type="submit">Submit</button></form>`;

      // Display form in a modal or replace container for demo purpose
      const container = document.getElementById('jobs-container');
      container.innerHTML = formHtml;

      document.getElementById('submissionForm').addEventListener('submit', e => {
        e.preventDefault();
        alert('Submission logic here');
        // You can handle uploading text proof, screenshot, etc.
      });
    }
  </script>
</body>
</html>
